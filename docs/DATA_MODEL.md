# Data Model Documentation

## Database Schema Overview

The Social Media Sentiment Analytics System uses a **PostgreSQL database** (H2 for development) with a normalized schema designed for cross-platform social media data.

## Core Entities

### 1. SocialPost Entity

**Table**: `social_posts`

**Purpose**: Central entity representing social media posts across Reddit and YouTube platforms.

#### Schema Definition
```sql
CREATE TABLE social_posts (
    id BIGINT PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
    external_id VARCHAR(100) NOT NULL,
    platform VARCHAR(20) NOT NULL,
    title VARCHAR(500) NOT NULL,
    content TEXT,
    author VARCHAR(100) NOT NULL,
    created_at TIMESTAMP NOT NULL,
    ingested_at TIMESTAMP NOT NULL,
    processed_at TIMESTAMP,
    content_hash VARCHAR(64),
    
    -- Engagement metrics
    upvotes BIGINT DEFAULT 0,           -- Reddit only
    like_count BIGINT DEFAULT 0,        -- YouTube only  
    view_count BIGINT DEFAULT 0,        -- YouTube only
    comment_count BIGINT DEFAULT 0,     -- Both platforms
    share_count BIGINT DEFAULT 0,       -- Both platforms
    engagement_score DOUBLE DEFAULT 0.0, -- Calculated field
    
    -- Platform-specific context
    subreddit VARCHAR(100),             -- Reddit: r/technology
    video_id VARCHAR(500),              -- YouTube: dQw4w9WgXcQ  
    url VARCHAR(1000),                  -- External URL
    
    -- Constraints
    CONSTRAINT uk_external_platform UNIQUE (external_id, platform)
);
```

#### Indexes
```sql
CREATE INDEX idx_platform_created ON social_posts (platform, created_at);
CREATE INDEX idx_engagement ON social_posts (engagement_score);
CREATE INDEX idx_subreddit ON social_posts (subreddit);
CREATE INDEX idx_video_id ON social_posts (video_id);
CREATE UNIQUE INDEX idx_external_platform ON social_posts (external_id, platform);
```

#### Field Definitions

| Field | Type | Required | Platform | Description |
|-------|------|----------|----------|-------------|
| `id` | BIGINT | ✅ | Both | Auto-generated primary key |
| `external_id` | VARCHAR(100) | ✅ | Both | Platform-specific post ID |
| `platform` | VARCHAR(20) | ✅ | Both | REDDIT or YOUTUBE |
| `title` | VARCHAR(500) | ✅ | Both | Post title (both platforms have titles in 2025) |
| `content` | TEXT | - | Both | Post content (optional for YouTube) |
| `author` | VARCHAR(100) | ✅ | Both | Author username |
| `created_at` | TIMESTAMP | ✅ | Both | When post was created on platform |
| `ingested_at` | TIMESTAMP | ✅ | Both | When we ingested the post |
| `processed_at` | TIMESTAMP | - | Both | When post was processed for analytics |
| `content_hash` | VARCHAR(64) | - | Both | MD5 hash for duplicate detection |
| `upvotes` | BIGINT | - | Reddit | Reddit upvotes (no downvotes in 2025) |
| `like_count` | BIGINT | - | YouTube | YouTube likes |
| `view_count` | BIGINT | - | YouTube | YouTube video views |
| `comment_count` | BIGINT | - | Both | Number of comments |
| `share_count` | BIGINT | - | Both | Number of shares |
| `engagement_score` | DOUBLE | - | Both | Calculated engagement metric |
| `subreddit` | VARCHAR(100) | - | Reddit | Subreddit name (without r/) |
| `video_id` | VARCHAR(500) | - | YouTube | YouTube video ID |
| `url` | VARCHAR(1000) | - | Both | External URL |

#### Business Rules
1. **Uniqueness**: Combination of `external_id` + `platform` must be unique
2. **Platform Validation**: 
   - Reddit posts must have `subreddit` and `content`
   - YouTube posts must have `video_id`
3. **Content Hash**: Auto-generated MD5 hash of normalized content
4. **Engagement Score**: Auto-calculated using platform-specific algorithms

### 2. SentimentData Entity

**Table**: `sentiment_data`

**Purpose**: Stores sentiment analysis results with confidence metrics.

#### Schema Definition
```sql
CREATE TABLE sentiment_data (
    id BIGINT PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
    social_post_id BIGINT NOT NULL,
    sentiment_label VARCHAR(20) NOT NULL,
    sentiment_score DOUBLE NOT NULL,
    confidence DOUBLE NOT NULL,
    processed_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    
    -- Foreign key constraint
    CONSTRAINT fk_sentiment_social_post 
        FOREIGN KEY (social_post_id) REFERENCES social_posts(id),
    
    -- Unique constraint (one sentiment per post)
    CONSTRAINT uk_sentiment_post UNIQUE